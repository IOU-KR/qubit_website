<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QUBIT ê²°ê³¼ ë° ì‹ ì²­ì„œ ì¡°íšŒ</title>
    <link rel="icon" href="/image/Qubit3.svg"/>
    <link rel="stylesheet" href="/styles/container.css"/>
</head>
<body>
    <div id="tabs" class="tab_closed">
        <svg id="more" width="50" height="50" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
            <g fill="#000000" stroke="none">
                <path id="more1" d="M4 4H16V6H4Z"/>
                <path id="more2" d="M4 9H16V11H4Z"/>
                <path id="more3" d="M4 14H16V16H4Z"/>
            </g>
        </svg>
        <div id="tab_menu">
            <div id="main">ì†Œê°œ</div> <br>
            <div id="branding">ë¸Œëœë”©</div> <br>
            <div id="apply2">ì…ë¶€ì‹ ì²­</div> <br>
            <div id="intro">íšŒì¥ ì†Œê°œ</div> <br>
            <div id="results" class="selected">í•©ê²©ì ë°œí‘œ</div>
        </div>
    </div>
    <div id="app_bar" class="card">
        <svg id="logo" width="100" height="30" viewBox="0 0 1656 468" xmlns="http://www.w3.org/2000/svg">
            <g fill="#000000" stroke="none" fill-rule="evenodd">
            <path d="M391 468L317.498 394.913C317.498 394.913 280 428 207 428C89.7 428 0 335.267 0 214C0 92.7334 89.7 0 207 0C324.3 0 414 92.7333 414 214C413.667 271 392.495 309.074 392.495 309.074L471.418 387.582L391 468M207 321C148.633 321 104 274.633 104 214C104 153.367 148.633 107 207 107C265.933 107 311 153.367 311 214C311 274.633 265.934 321 207 321"/>
            <path d="M626 430C531.933 430 460 350.267 460 246V4H559.6V244.455C559.6 291.559 590.587 332.775 626 332.775C661.413 332.775 692.4 291.559 692.4 244.455V4H792V246C792 350.267 720.067 430 626 430"/>
            <path d="M822 430V4H971.72C1013.81 4 1098 46.6666 1098 132C1098 180.167 1059.53 217 1059.53 217C1059.53 217 1098 253.833 1098 302C1098 387.333 1013.81 430 971.722 430H822M920 90H943.881C969.136 90 998 107.879 998 131C998 154.121 969.136 172 943.881 172H920V90M920 262H943.881C969.136 262 998 279.879 998 303C998 326.121 969.136 344 943.881 344H920z"/>
            <path d="M1140 432V4H1252V432z"/>
            <path d="M1416 432V114H1286V4H1656V114H1528V432z"/>
            </g>
        </svg>
    </div>
    <button id="apply">ì…ë¶€ì‹ ì²­</button>
    <div id="container" style="overflow-x: hidden;">
        <div class="header">ê²°ê³¼ ë° ì‹ ì²­ì„œ ì¡°íšŒ</div>
        <div hidden id="not-published" class="text_container" style="color: red;">ì•„ì§ ê²°ê³¼ ë°œí‘œ ì‹œê°„ì´ ì•„ë‹™ë‹ˆë‹¤. ì‹ ì²­ì„œ ì¡°íšŒë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.</div><br>
        <br>
        <div class="text_container text_small">
            ì•„ë˜ì— ì´ë¦„ê³¼ í•™ë°˜ë²ˆí˜¸, ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ê³  ì¡°íšŒí•˜ê¸°ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.<br>
        </div>
        
        <label class="label">ì´ë¦„</label><br>
        <div class="input"><input class="text_small" id="real-name" maxlength="20" placeholder="í™ê¸¸ë™"></input></div><br><br>
        <label class="label">í•™ë°˜ë²ˆí˜¸ (1101)</label><br>
        <div class="input"><input class="text_small" id="id-number" type="number" maxlength="5" placeholder="1101" ></input></div><br><br>
        <label class="label">ë¹„ë°€ë²ˆí˜¸</label><br>
        <div class="input"><input class="text_small" id="password" type="password" maxlength="500" placeholder="ìµœì†Œ 10ì"></input></div><br><br>
        <button id="submit">ì¡°íšŒí•˜ê¸°</button>
        <br>
        <br>
        <div hidden id="result">
            <div class="header">ê²°ê³¼</div>
            <br>
            <div id="pass_or_not" class="header" style="font-size: 50px;"></div>
            <br>
            <br>
            <div hidden id="message" class="text_container"  style="color: orange;"></div>
            <div class="header">ì‹ ì²­ì„œ</div>
            <label class="label">ìê¸° ì§„ë¡œì™€ì˜ ì—°ê´€ì„± (ì„ íƒ)</label><br>
            <div class="input"><textarea id="career" oninput="fit(this)" maxlength="500" placeholder="ì €ì˜ ì§„ë¡œëŠ” ...&#10;(ìµœëŒ€ 500ì)" ></textarea></div><br><br>
            <label class="label">ì´ ë™ì•„ë¦¬ë¥¼ ì„ íƒí•œ ì´ìœ  (ì„ íƒ)</label><br>
            <div class="input"><textarea id="reason" oninput="fit(this)" maxlength="500" placeholder="ì´ ë™ì•„ë¦¬ë¥¼ ì„ íƒí•œ ì´ìœ ëŠ” ...&#10;(ìµœëŒ€ 500ì)" ></textarea></div><br><br>
            <label class="label">ì‚¬ìš©í•´ë³¸ ì½”ë”© ì–¸ì–´ ë° ê¸°íƒ€ ê¸°ìˆ  (ì„ íƒ)</label><br>
            <div class="input"><textarea id="skills" oninput="fit(this)" maxlength="500" placeholder="ì—”íŠ¸ë¦¬, íŒŒì´ì¬, ë¦¬ëˆ…ìŠ¤, ...&#10;(ìµœëŒ€ 500ì)" ></textarea></div><br><br>
            <label class="label">ê·¸ì™¸ ìê¸°ì†Œê°œ (ì„ íƒ)</label><br>
            <div class="input"><textarea id="other" oninput="fit(this)" maxlength="500" placeholder="ì €ëŠ” ...&#10;(ìµœëŒ€ 500ì)" ></textarea></div><br><br><br>
            <br>
        </div>
        
    </div>
    <script>
        function fit(element) {
            element.style.height = '5em';
            element.style.height = element.scrollHeight+'px';
        }

        const realNameInput = document.getElementById('real-name');
        const idNumberInput = document.getElementById('id-number');
        const passwordInput = document.getElementById('password');
        const submitButton = document.getElementById('submit');

        const pass_or_not = document.getElementById('pass_or_not');
        const resultDiv = document.getElementById('result');
        const message = document.getElementById('message');
        const notPublishedDiv = document.getElementById('not-published');

        const careerInput = document.getElementById('career');
        const reasonInput = document.getElementById('reason');
        const skillsInput = document.getElementById('skills');
        const otherInput = document.getElementById('other');

        let published = false;
        fetch('/api/deadline', { method: 'GET' }).then(r => r.json()).then(response => {
            const deadline = new Date(response.deadline);
            const result = new Date(response.result);
            
            if (Date.now() > result.getTime()) {
                published = true;
            } else {
                notPublishedDiv.hidden = false;
            }
        });


        submit.addEventListener('click',() => {
            try {
                if (!realNameInput.value || realNameInput.value.length<2 || realNameInput.value.length>20) {
                    throw new Error('ì‹¤ëª…ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                }
                if (!idNumberInput.value || idNumberInput.value.length<4 || 5<idNumberInput.value.length || isNaN(idNumberInput.value)) {
                    throw new Error('í•™ë°˜ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                }

                let parsedIdNumber = parseInt(idNumberInput.value);

                if (parsedIdNumber < 0 || parsedIdNumber !== parseFloat(idNumberInput.value)) {
                    throw new Error('í•™ë°˜ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                }
                if (!passwordInput.value || passwordInput.value.length<9) {
                    throw new Error('ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 9ê¸€ìì—¬ì•¼ í•©ë‹ˆë‹¤.');
                }

                fetch('/api/result', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        realName: realNameInput.value,
                        idNumber: idNumberInput.value,
                        plainPassword: passwordInput.value,
                    })
                }).then(r => r.json()).then(response => {
                    if (response.ok) {
                        console.log(response);
                        resultDiv.hidden = false;
                        message.hidden = false;
                        message.innerHTML = response.result_message;
                        careerInput.value = response.form.career;
                        reasonInput.value = response.form.reason;
                        skillsInput.value = response.form.skills;
                        otherInput.value = response.form.other;

                        if (response.result === 'PENDING') {
                            pass_or_not.innerHTML = 'ê²°ê³¼ ì—†ìŒ';
                            return;
                        }
                        if (response.result === 'ACCEPTED') {
                            pass_or_not.innerHTML = 'í•©ê²©! ğŸ‰';
                            return;
                        }
                        if (response.result === 'REJECTED') {
                            pass_or_not.innerHTML = 'ë¶ˆí•©ê²©';
                            return;
                        }
                        return;
                    }
                    alert('ì˜¤ë¥˜: '+response.message);
                });
            } catch (error) {
                alert(error.message);
            }
        });
    </script>
    <script src="/scripts/index.js"></script>
</body>
</html>
